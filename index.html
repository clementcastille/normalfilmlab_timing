<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#FFFFFF">
  <title>nfl_timing</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="NFL_timing">
  <meta name="description" content="Professional timer for C-41 and B&W film development">
  
  <style>
    .chrono-font {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
      font-weight: 800;
      font-variant-numeric: tabular-nums;
      letter-spacing: -4px;
    }
    
    .back-btn {
      position: fixed;
      left: 20px;
      top: env(safe-area-inset-top, 20px);
      top: max(20px, env(safe-area-inset-top));
      width: 44px;
      height: 44px;
      padding: 0;
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
      z-index: 100;
    }
    
    .back-btn:active {
      transform: scale(0.9);
    }
    
    .back-btn svg {
      width: 28px;
      height: 28px;
      fill: #1A1A1A;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    html, body {
      height: 100%;
      background: #FFFFFF;
      color: #1A1A1A;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
      -webkit-font-smoothing: antialiased;
      overflow: hidden;
      position: fixed;
      width: 100%;
      overscroll-behavior: none;
      touch-action: pan-y;
    }

    .welcome-screen {
      height: 100vh;
      height: 100dvh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: max(80px, env(safe-area-inset-top)) 30px max(80px, env(safe-area-inset-bottom));
      position: relative;
    }

    .welcome-content {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 60px;
      width: 100%;
    }

    .welcome-logo {
      position: absolute;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
    }

    .welcome-logo img {
      height: 20px;
      width: auto;
    }

    .process-choice {
      display: flex;
      flex-direction: column;
      gap: 20px;
      align-items: center;
    }

    .process-option {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .process-btn {
      font-size: 100px;
      font-weight: 800;
      background: transparent;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      color: #1A1A1A;
      line-height: 1;
      letter-spacing: 8px;
      padding: 0;
    }

    .process-btn:active {
      transform: scale(0.95);
      color: #666666;
    }

    .or-separator {
      font-size: 20px;
      font-weight: 500;
      color: #999999;
      text-transform: lowercase;
    }

    @media (min-width: 768px) {
      .process-btn {
        font-size: 120px;
      }
    }

    @media (max-height: 700px) {
      .process-btn {
        font-size: 80px;
      }
    }

    .config-screen {
      height: 100vh;
      height: 100dvh;
      display: flex;
      flex-direction: column;
      padding: max(80px, calc(env(safe-area-inset-top) + 60px)) 30px max(80px, env(safe-area-inset-bottom));
      align-items: center;
      position: relative;
      overflow: hidden;
    }

    @media (min-width: 768px) {
      .config-screen {
        padding: max(60px, env(safe-area-inset-top)) 30px max(80px, env(safe-area-inset-bottom));
      }
    }

    .config-title {
      font-size: 24px;
      font-weight: 600;
      text-transform: lowercase;
      color: #000000;
      text-align: center;
      margin-bottom: 10px;
    }

    .time-inputs {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 30px;
      width: 100%;
      padding-top: 0px;
    }

    @media (min-width: 768px) {
      .time-inputs {
        gap: 40px;
      }
    }

    .time-inputs-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 60px;
    }

    @media (min-width: 768px) {
      .time-inputs-container {
        gap: 60px;
      }
    }

    .time-input-row {
      display: flex;
      flex-direction: column;
      gap: 15px;
      align-items: center;
    }

    @media (min-width: 768px) {
      .time-input-row {
        gap: 15px;
      }
    }

    .time-input-row label {
      font-size: 16px;
      font-weight: 600;
      text-transform: lowercase;
      color: #666666;
      text-align: center;
    }

    .time-fields {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .time-fields input {
      font-size: 110px;
      font-weight: 800;
      border: none;
      background: transparent;
      color: #1A1A1A;
      width: auto;
      min-width: 0;
      padding: 0;
      line-height: 1;
      letter-spacing: -4px;
      text-align: center;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
      font-variant-numeric: tabular-nums;
    }

    @media (min-width: 768px) {
      .time-fields input {
        font-size: 120px;
      }
    }

    .time-fields input::-webkit-outer-spin-button,
    .time-fields input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .time-fields input[type=number] {
      -moz-appearance: textfield;
    }

    .time-fields input:focus {
      outline: none;
    }

    .time-separator {
      font-size: 70px;
      font-weight: 800;
      color: #1A1A1A;
      line-height: 1;
      margin: 0 -2px;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
    }

    @media (min-width: 768px) {
      .time-separator {
        font-size: 80px;
        margin: 0 -4px;
      }
    }

    .validate-btn {
      padding: 20px 60px;
      font-size: 18px;
      font-weight: 700;
      background: #000000;
      color: #FFFFFF;
      border: none;
      border-radius: 100px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: lowercase;
      width: auto;
    }

    .validate-btn:active {
      transform: scale(0.98);
    }

    @media (max-height: 700px) {
      .time-fields input {
        font-size: 100px;
      }
      .time-separator {
        font-size: 70px;
      }
    }

    .steps-screen {
      height: 100vh;
      height: 100dvh;
      display: flex;
      flex-direction: column;
      padding: max(60px, calc(env(safe-area-inset-top) + 40px)) 30px max(80px, env(safe-area-inset-bottom));
      align-items: center;
      overflow: hidden;
    }

    /* NOUVEAU : Conteneur centré pour iPad et écrans larges */
    @media (min-width: 768px) {
      .steps-screen {
        justify-content: center;
      }
      
      .steps-screen-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        max-width: 600px;
        width: 100%;
        gap: 20px;
      }
    }

    .steps-header {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 0px;
      max-width: 600px;
      width: 100%;
      position: relative;
      height: 44px;
      flex-shrink: 0;
    }

    .settings-icon {
      cursor: pointer;
      padding: 0;
      background: none;
      border: none;
      transition: transform 0.2s;
      line-height: 1;
      position: fixed;
      right: 20px;
      top: max(20px, env(safe-area-inset-top));
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .settings-icon:active {
      transform: scale(0.9);
    }
    
    .settings-icon svg {
      width: 28px;
      height: 28px;
      fill: #1A1A1A;
      transition: fill 0.2s;
    }

    .steps-progress-container {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      width: 100%;
      max-width: 500px;
      margin-top: 5px;
      flex-shrink: 0;
    }

    .progress-percentage-container {
      display: flex;
      align-items: baseline;
      gap: 8px;
    }

    .progress-percentage {
      font-size: 20px;
      font-weight: 700;
      color: #1A1A1A;
      line-height: 1;
    }

    .progress-label {
      font-size: 12px;
      font-weight: 600;
      color: #999999;
      text-transform: lowercase;
    }

    .total-time-container {
      display: flex;
      align-items: baseline;
      gap: 8px;
    }

    .total-time {
      font-size: 20px;
      font-weight: 700;
      color: #1A1A1A;
      line-height: 1;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
      font-variant-numeric: tabular-nums;
    }

    .total-label {
      font-size: 12px;
      font-weight: 600;
      color: #999999;
      text-transform: lowercase;
    }

    .steps-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      width: 100%;
      max-width: 600px;
      flex: 1;
      overflow: hidden;
      min-height: 0;
    }

    .steps-title {
      font-size: 22px;
      font-weight: 700;
      color: #1A1A1A;
      text-transform: lowercase;
      text-align: center;
      flex-shrink: 0;
      margin-top: 20px;
    }

    .steps-matrix {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      max-width: 180px;
      flex-shrink: 0;
      margin-bottom: 20px;
    }

    .step-dot {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #E0E0E0;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      flex-shrink: 0;
    }

    .step-dot.completed {
      background: #FF7518;
    }

    .step-dot:hover::after {
      content: attr(data-name);
      position: absolute;
      bottom: -35px;
      left: 50%;
      transform: translateX(-50%);
      background: #1A1A1A;
      color: #FFFFFF;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      white-space: nowrap;
      font-weight: 600;
      z-index: 10;
      pointer-events: none;
    }

    .steps-details {
      display: flex;
      flex-direction: column;
      gap: 4px;
      width: 100%;
      max-width: 500px;
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      min-height: 0;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .steps-details::-webkit-scrollbar {
      display: none;
    }

    .step-detail-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 20px;
      background: #F5F5F5;
      border-radius: 10px;
      font-size: 15px;
      transition: all 0.2s ease;
    }

    .step-detail-item.completed {
      background: #FF7518;
    }

    .step-detail-name {
      font-weight: 600;
      text-transform: uppercase;
      color: #1A1A1A;
    }

    .step-detail-time {
      font-weight: 700;
      color: #666666;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
      font-variant-numeric: tabular-nums;
    }

    .steps-bottom {
      padding-top: 10px;
      padding-bottom: 15px;
      width: 100%;
      max-width: 600px;
      display: flex;
      justify-content: center;
      flex-shrink: 0;
    }

    .start-btn {
      width: auto;
      padding: 20px 60px;
      font-size: 18px;
      font-weight: 700;
      background: #000000;
      color: #FFFFFF;
      border: none;
      border-radius: 100px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: lowercase;
      box-shadow: 0 3px 0 0 #FFFFFF;
    }

    .start-btn:active {
      transform: scale(0.98);
    }

    .timer-screen {
      height: 100vh;
      height: 100dvh;
      display: flex;
      flex-direction: column;
      padding: max(100px, calc(env(safe-area-inset-top) + 80px)) 20px max(80px, env(safe-area-inset-bottom));
      justify-content: space-between;
      overflow: hidden;
    }

    .timer-header {
      display: flex;
      justify-content: center;
      align-items: center;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      width: 100%;
      flex-shrink: 0;
      position: relative;
    }

    .timer-main {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 40px;
      max-width: 600px;
      margin: 0 auto;
      width: 100%;
      flex: 1;
    }

    .step-name {
      font-size: 20px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 1px;
      text-align: center;
    }

    .countdown-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .countdown-digit {
      font-size: 90px;
      font-weight: 800;
      color: #1A1A1A;
      letter-spacing: -4px;
      line-height: 1;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
      font-variant-numeric: tabular-nums;
    }

    @media (min-width: 768px) {
      .countdown-digit {
        font-size: 120px;
      }
    }

    .countdown-separator {
      font-size: 60px;
      font-weight: 800;
      color: #1A1A1A;
      line-height: 1;
      margin: 0 -2px;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
    }

    @media (min-width: 768px) {
      .countdown-separator {
        font-size: 80px;
        margin: 0 -4px;
      }
    }

    .countdown-digit.warning {
      color: #d61e33;
    }
    
    .countdown-separator.warning {
      color: #d61e33;
    }

    .progress-dots {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      max-width: 180px;
    }

    .progress-dot {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #E0E0E0;
      transition: all 0.3s ease;
    }

    .progress-dot.completed {
      background: #000000;
    }

    .progress-dot.active {
      background: #000000;
      transform: scale(1.2);
    }

    .timer-controls {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
      flex-shrink: 0;
      padding: 0 5px;
    }

    .control-btn {
      width: 100%;
      padding: 24px 16px;
      font-size: 16px;
      font-weight: 600;
      background: #F5F5F5;
      color: #1A1A1A;
      border: none;
      border-radius: 100px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      min-height: 64px;
    }

    @media (min-width: 768px) {
      .control-btn {
        padding: 28px 20px;
        font-size: 18px;
        letter-spacing: 1px;
        min-height: 72px;
      }
    }

    .control-btn.primary {
      background: #00713d;
      color: #FFFFFF;
    }

    .control-btn.pause {
      background: #FF6B35;
      color: #FFFFFF;
    }

    .control-btn.resume {
      background: #1e8fd6;
      color: #FFFFFF;
    }

    .control-btn.reset {
      background: #e84033;
      color: #FFFFFF;
    }

    .control-btn.disabled {
      background: #E0E0E0;
      color: #999999;
      cursor: not-allowed;
    }

    .control-btn:active {
      transform: scale(0.98);
    }
    
    #skipBtn {
      background: #f2b826;
      color: #000000;
    }

    .settings-screen {
      height: 100vh;
      height: 100dvh;
      display: flex;
      flex-direction: column;
      padding: max(60px, calc(env(safe-area-inset-top) + 40px)) 30px max(80px, env(safe-area-inset-bottom));
      align-items: center;
      overflow: hidden;
    }

    .settings-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 100%;
      max-width: 500px;
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      min-height: 0;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .settings-list::-webkit-scrollbar {
      display: none;
    }

    @media (min-width: 768px) {
      .settings-list {
        gap: 12px;
      }
    }

    .setting-item {
      display: flex;
      flex-wrap: nowrap;
      gap: 6px;
      align-items: center;
      padding: 10px 8px;
      background: #F5F5F5;
      border-radius: 10px;
      border: none;
      transition: all 0.2s ease;
    }

    @media (min-width: 768px) {
      .setting-item {
        flex-wrap: nowrap;
        gap: 10px;
        padding: 12px 16px;
      }
    }

    .setting-item .order-number {
      font-size: 12px;
      font-weight: 700;
      text-align: center;
      min-width: 20px;
      color: #666666;
      flex-shrink: 0;
    }

    .arrow-btn {
      cursor: pointer;
      padding: 2px;
      background: none;
      border: none;
      text-align: center;
      color: #999999;
      transition: all 0.2s ease;
      flex-shrink: 0;
      min-width: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .arrow-btn svg {
      fill: #999999;
      transition: fill 0.2s ease;
    }

    .arrow-btn:disabled {
      cursor: not-allowed;
      opacity: 0.3;
    }

    .arrow-btn:not(:disabled):hover svg {
      fill: #1A1A1A;
    }

    .arrow-btn:not(:disabled):active {
      transform: scale(0.9);
    }

    @media (min-width: 768px) {
      .setting-item .order-number {
        min-width: 28px;
      }
    }

    .setting-item input[type="text"] {
      padding: 0;
      font-size: 13px;
      border: none;
      background: transparent;
      text-transform: uppercase;
      font-weight: 600;
      flex: 1;
      min-width: 80px;
      color: #1A1A1A;
      width: auto;
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }

    @media (min-width: 768px) {
      .setting-item input[type="text"] {
        width: auto;
      }
    }

    .setting-item input[type="text"]:focus {
      outline: 2px solid #1A1A1A;
      background: #FFFFFF;
    }

    .setting-item .time-group {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-shrink: 0;
    }

    .time-display {
      font-size: 13px;
      font-weight: 700;
      color: #1A1A1A;
      cursor: pointer;
      padding: 4px 6px;
      border-radius: 6px;
      transition: background 0.2s;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
      font-variant-numeric: tabular-nums;
      flex-shrink: 0;
      white-space: nowrap;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }

    .time-display:hover {
      background: #E0E0E0;
    }

    .time-edit-container {
      display: flex;
      gap: 2px;
      align-items: center;
    }

    .time-edit-input {
      padding: 2px 4px;
      font-size: 14px;
      text-align: center;
      border: 1px solid #CCCCCC;
      border-radius: 4px;
      background: #FFFFFF;
      font-weight: 700;
      width: 40px;
      color: #1A1A1A;
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }

    .time-edit-separator {
      font-size: 14px;
      font-weight: 700;
      color: #1A1A1A;
    }

    .setting-item .controls-wrapper {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-shrink: 0;
      margin-left: auto;
    }

    @media (max-width: 500px) {
      .setting-item {
        padding: 10px;
      }
      
      .setting-item .order-number {
        order: 1;
      }
      
      .setting-item input[type="text"] {
        order: 2;
        flex-basis: calc(100% - 40px);
      }
      
      .setting-item .time-group {
        order: 3;
        margin-top: 4px;
      }
      
      .setting-item .controls-wrapper {
        order: 4;
        margin-left: auto;
        margin-top: 4px;
      }
    }

    .setting-item input[type="number"] {
      padding: 0;
      font-size: 14px;
      text-align: center;
      border: none;
      background: transparent;
      font-weight: 700;
      width: 42px;
      color: #1A1A1A;
    }

    @media (min-width: 768px) {
      .setting-item input[type="number"] {
        width: 48px;
      }
    }

    .setting-item input[type="number"]:focus {
      outline: none;
    }

    .setting-item .time-label {
      font-size: 10px;
      text-transform: lowercase;
      color: #999999;
      font-weight: 600;
    }

    .icon-btn {
      font-size: 22px;
      cursor: pointer;
      padding: 2px;
      background: none;
      border: none;
      text-align: center;
      color: #999999;
      transition: all 0.2s ease;
      flex-shrink: 0;
      min-width: 24px;
    }

    @media (min-width: 768px) {
      .icon-btn {
        font-size: 22px;
        padding: 5px;
      }
    }

    .icon-btn:hover {
      color: #1A1A1A;
    }

    .icon-btn:active {
      transform: scale(0.9);
    }

    .add-step-btn {
      padding: 16px 40px;
      font-size: 16px;
      font-weight: 700;
      background: #F5F5F5;
      color: #1A1A1A;
      border: none;
      border-radius: 100px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: lowercase;
      width: auto;
      flex-shrink: 0;
    }

    @media (min-width: 768px) {
      .add-step-btn {
        padding: 18px 45px;
        font-size: 16px;
      }
    }

    .add-step-btn:active {
      transform: scale(0.98);
      background: #E0E0E0;
    }

    .settings-actions {
      display: flex;
      gap: 12px;
      width: 100%;
      max-width: 500px;
      margin: 12px auto 0;
      flex-shrink: 0;
      justify-content: flex-end;
      align-items: center;
    }

    @media (min-width: 768px) {
      .settings-actions {
        margin: 20px auto 0;
        gap: 16px;
      }
    }

    .save-btn {
      padding: 16px 50px;
      font-size: 16px;
      font-weight: 700;
      background: #000000;
      color: #FFFFFF;
      border: none;
      border-radius: 100px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: lowercase;
      width: auto;
      flex-shrink: 0;
    }

    @media (min-width: 768px) {
      .save-btn {
        padding: 18px 55px;
        font-size: 16px;
      }
    }

    .save-btn:active {
      transform: scale(0.98);
    }

    .hidden {
      display: none !important;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal-content {
      background: #FFFFFF;
      border-radius: 20px;
      padding: 30px;
      max-width: 340px;
      width: 100%;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
      color: #1A1A1A;
      text-align: center;
      margin-bottom: 12px;
      text-transform: lowercase;
    }

    .modal-message {
      font-size: 15px;
      color: #666666;
      text-align: center;
      margin-bottom: 24px;
      line-height: 1.4;
    }

    .modal-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .modal-btn {
      padding: 16px;
      font-size: 16px;
      font-weight: 700;
      border: none;
      border-radius: 100px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: lowercase;
    }

    .modal-btn-confirm {
      background: #e84033;
      color: #FFFFFF;
    }

    .modal-btn-cancel {
      background: #F5F5F5;
      color: #1A1A1A;
    }

    .modal-btn:active {
      transform: scale(0.98);
    }

    @media only screen 
      and (device-width: 414px) 
      and (device-height: 896px) 
      and (-webkit-device-pixel-ratio: 2) {
      
      body {
        padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      }
      
      .process-btn {
        font-size: 95px;
      }
      
      .countdown-digit {
        font-size: 95px;
      }
      
      .countdown-separator {
        font-size: 65px;
      }
      
      .control-btn {
        min-height: 62px;
        font-size: 16px;
      }
    }

    @media (max-height: 700px) {
      .countdown {
        font-size: 80px;
      }
      .time-fields input {
        font-size: 80px;
      }
      .time-separator {
        font-size: 50px;
      }
      .settings-header {
        margin-bottom: 15px;
      }
      .settings-list {
        gap: 6px;
      }
      .setting-item {
        padding: 8px;
      }
      .add-step-btn {
        padding: 12px;
        margin-top: 10px;
      }
      .save-btn {
        padding: 14px;
      }
      .settings-actions {
        margin-top: 10px;
      }
      .time-inputs {
        gap: 15px;
      }
      .time-inputs-container {
        gap: 25px;
      }
      .time-input-row {
        gap: 8px;
      }
      .config-screen {
        padding: max(80px, calc(env(safe-area-inset-top) + 60px)) 30px max(70px, env(safe-area-inset-bottom));
      }
    }

    @media (max-height: 600px) {
      .timer-main {
        gap: 30px;
      }
      .countdown {
        font-size: 70px;
      }
      .control-btn {
        padding: 14px 10px;
        font-size: 12px;
      }
      .settings-screen {
        padding: max(10px, env(safe-area-inset-top)) 15px max(15px, env(safe-area-inset-bottom));
      }
      .settings-header {
        margin-bottom: 10px;
      }
      .settings-header h2 {
        font-size: 16px;
      }
      .settings-list {
        gap: 6px;
      }
      .setting-item {
        padding: 8px;
        font-size: 13px;
      }
      .setting-item input[type="text"],
      .setting-item input[type="number"] {
        font-size: 13px;
      }
      .add-step-btn {
        padding: 10px;
        font-size: 14px;
        margin-top: 8px;
      }
      .save-btn {
        padding: 12px;
        font-size: 15px;
      }
      .settings-actions {
        margin-top: 8px;
      }
      .time-inputs {
        gap: 12px;
      }
      .time-inputs-container {
        gap: 20px;
      }
      .time-input-row {
        gap: 6px;
      }
      .time-fields input {
        font-size: 70px;
      }
      .time-separator {
        font-size: 45px;
      }
      .config-screen {
        padding: max(80px, calc(env(safe-area-inset-top) + 60px)) 30px max(60px, env(safe-area-inset-bottom));
      }
    }
  </style>
</head>
<body>
  
  <div id="welcomeScreen" class="welcome-screen">
    <div class="welcome-content">
      <div class="process-choice">
        <div class="process-option">
          <button class="process-btn" onclick="selectProcess('c41')">C-41</button>
        </div>
        <div class="or-separator">or</div>
        <div class="process-option">
          <button class="process-btn" onclick="selectProcess('nb')">N&B</button>
        </div>
      </div>
    </div>
    <div class="welcome-logo">
      <img src="logo.png" alt="FilmLab Logo">
    </div>
  </div>

  <div id="configC41Screen" class="config-screen hidden">
    <button class="back-btn config-back-btn" onclick="backToWelcome()">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
      </svg>
    </button>
    
    <div class="time-inputs">
      <div class="config-title">configuration</div>
      
      <div class="time-inputs-container">
        <div class="time-input-row">
          <label>developer</label>
          <div class="time-fields">
            <input type="number" id="revMin" min="0" max="99" value="03" inputmode="numeric" pattern="[0-9]*">
            <span class="time-separator">:</span>
            <input type="number" id="revSec" min="0" max="59" value="15" inputmode="numeric" pattern="[0-9]*">
          </div>
        </div>
        
        <div class="time-input-row">
          <label>bleach</label>
          <div class="time-fields">
            <input type="number" id="bleachMin" min="0" max="99" value="06" inputmode="numeric" pattern="[0-9]*">
            <span class="time-separator">:</span>
            <input type="number" id="bleachSec" min="0" max="59" value="30" inputmode="numeric" pattern="[0-9]*">
          </div>
        </div>
      </div>
    </div>
    
    <button class="validate-btn" onclick="validateC41()">validate</button>
  </div>

  <div id="configNBScreen" class="config-screen hidden">
    <button class="back-btn config-back-btn" onclick="backToWelcome()">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
      </svg>
    </button>
    
    <div class="time-inputs">
      <div class="config-title">configuration</div>
      
      <div class="time-inputs-container">
        <div class="time-input-row">
          <label>developer</label>
          <div class="time-fields">
            <input type="number" id="nbRevMin" min="0" max="99" value="00" inputmode="numeric" pattern="[0-9]*">
            <span class="time-separator">:</span>
            <input type="number" id="nbRevSec" min="0" max="59" value="00" inputmode="numeric" pattern="[0-9]*">
          </div>
        </div>
        
        <div class="time-input-row">
          <label>fixer</label>
          <div class="time-fields">
            <input type="number" id="nbFixMin" min="0" max="99" value="00" inputmode="numeric" pattern="[0-9]*">
            <span class="time-separator">:</span>
            <input type="number" id="nbFixSec" min="0" max="59" value="00" inputmode="numeric" pattern="[0-9]*">
          </div>
        </div>
      </div>
    </div>
    
    <button class="validate-btn" onclick="validateNB()">validate</button>
  </div>

  <div id="stepsScreen" class="steps-screen hidden">
    <div class="steps-header">
      <button class="back-btn back-to-config" onclick="backToConfig()">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
        </svg>
      </button>
      <button class="settings-icon" onclick="openSettings()">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 15.5C10.067 15.5 8.5 13.933 8.5 12C8.5 10.067 10.067 8.5 12 8.5C13.933 8.5 15.5 10.067 15.5 12C15.5 13.933 13.933 15.5 12 15.5ZM19.43 12.97C19.47 12.65 19.5 12.33 19.5 12C19.5 11.67 19.47 11.34 19.43 11L21.54 9.37C21.73 9.22 21.78 8.95 21.66 8.73L19.66 5.27C19.54 5.05 19.27 4.96 19.05 5.05L16.56 6.05C16.04 5.66 15.5 5.32 14.87 5.07L14.5 2.42C14.46 2.18 14.25 2 14 2H10C9.75 2 9.54 2.18 9.5 2.42L9.13 5.07C8.5 5.32 7.96 5.66 7.44 6.05L4.95 5.05C4.73 4.96 4.46 5.05 4.34 5.27L2.34 8.73C2.21 8.95 2.27 9.22 2.46 9.37L4.57 11C4.53 11.34 4.5 11.67 4.5 12C4.5 12.33 4.53 12.65 4.57 12.97L2.46 14.63C2.27 14.78 2.21 15.05 2.34 15.27L4.34 18.73C4.46 18.95 4.73 19.03 4.95 18.95L7.44 17.94C7.96 18.34 8.5 18.68 9.13 18.93L9.5 21.58C9.54 21.82 9.75 22 10 22H14C14.25 22 14.46 21.82 14.5 21.58L14.87 18.93C15.5 18.67 16.04 18.34 16.56 17.94L19.05 18.95C19.27 19.03 19.54 18.95 19.66 18.73L21.66 15.27C21.78 15.05 21.73 14.78 21.54 14.63L19.43 12.97Z"/>
        </svg>
      </button>
    </div>
    
    <div class="steps-content">
      <div class="steps-title">steps</div>
      
      <div class="steps-matrix" id="stepsMatrix"></div>
      
      <div class="steps-details" id="stepsDetails"></div>
      
      <div class="steps-progress-container">
        <div class="progress-percentage-container">
          <div class="progress-percentage" id="progressPercentage">0%</div>
        </div>
        
        <div class="total-time-container">
          <div class="total-time" id="totalTime">15:30</div>
          <div class="total-label">total</div>
        </div>
      </div>
    </div>
    
    <div class="steps-bottom">
      <button class="start-btn" onclick="startProcess()">start</button>
    </div>
  </div>

  <div id="timerScreen" class="timer-screen hidden">
    <div class="timer-header">
      <button class="back-btn back-arrow" onclick="backToSteps()">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
        </svg>
      </button>
      <div></div>
    </div>
    
    <div class="timer-main">
      <div class="step-name" id="currentStepName">PRE-WASH #1</div>
      
      <div class="countdown-container" id="countdownContainer">
        <span class="countdown-digit" id="countdownMinutes">1</span>
        <span class="countdown-separator">:</span>
        <span class="countdown-digit" id="countdownSeconds">00</span>
      </div>
      
      <div class="progress-dots" id="progressDots"></div>
    </div>
    
    <div class="timer-controls">
      <button class="control-btn primary" id="playPauseBtn" onclick="toggleTimer()">START</button>
      
      <button class="control-btn" id="skipBtn" onclick="skipStep()">NEXT</button>
      
      <button class="control-btn reset" id="resetBtn" onclick="resetTimer()">RESET</button>
    </div>
  </div>

  <audio id="stepCompleteSound" preload="auto"></audio>

  <div id="settingsScreen" class="settings-screen hidden">
    <div class="steps-header">
      <button class="back-btn" onclick="closeSettings()">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
        </svg>
      </button>
    </div>
    
    <div class="steps-content">
      <div class="steps-title">settings</div>
      
      <div class="settings-list" id="settingsList"></div>
      
      <div class="settings-actions">
        <button class="add-step-btn" onclick="addNewStep()">+ add step</button>
        <button class="save-btn" onclick="saveSettings()">save</button>
      </div>
    </div>
  </div>

  <div id="confirmModal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-message">Reset the current step timer to 0:00?</div>
      <div class="modal-buttons">
        <button class="modal-btn modal-btn-confirm" onclick="confirmReset()">RESET</button>
        <button class="modal-btn modal-btn-cancel" onclick="closeModal()">cancel</button>
      </div>
    </div>
  </div>

  <script>
    let currentSteps = [];
    let currentStepIndex = 0;
    let timerInterval = null;
    let remainingSeconds = 0;
    let isRunning = false;
    let completedSteps = [];
    let currentProcess = '';
    let wakeLock = null;

    async function requestWakeLock() {
      try {
        if ('wakeLock' in navigator) {
          wakeLock = await navigator.wakeLock.request('screen');
          console.log('Wake Lock activé');
        }
      } catch (err) {
        console.log('Wake Lock non disponible:', err);
      }
    }

    async function releaseWakeLock() {
      if (wakeLock !== null) {
        try {
          await wakeLock.release();
          wakeLock = null;
          console.log('Wake Lock désactivé');
        } catch (err) {
          console.log('Erreur Wake Lock:', err);
        }
      }
    }

    function backToWelcome() {
      document.getElementById('configC41Screen').classList.add('hidden');
      document.getElementById('configNBScreen').classList.add('hidden');
      document.getElementById('welcomeScreen').classList.remove('hidden');
    }

    function backToConfig() {
      document.getElementById('stepsScreen').classList.add('hidden');
      
      if (currentProcess === 'c41') {
        document.getElementById('configC41Screen').classList.remove('hidden');
      } else if (currentProcess === 'nb') {
        document.getElementById('configNBScreen').classList.remove('hidden');
      }
    }

    function selectProcess(type) {
      if (type === 'c41') {
        document.getElementById('welcomeScreen').classList.add('hidden');
        document.getElementById('configC41Screen').classList.remove('hidden');
      } else if (type === 'nb') {
        document.getElementById('welcomeScreen').classList.add('hidden');
        document.getElementById('configNBScreen').classList.remove('hidden');
      }
    }

    function validateC41() {
      currentProcess = 'c41';
      
      const saved = localStorage.getItem('c41_steps');
      
      if (saved) {
        try {
          currentSteps = JSON.parse(saved);
          
          const revMin = parseInt(document.getElementById('revMin').value) || 0;
          const revSec = parseInt(document.getElementById('revSec').value) || 0;
          const bleachMin = parseInt(document.getElementById('bleachMin').value) || 0;
          const bleachSec = parseInt(document.getElementById('bleachSec').value) || 0;
          
          const revDuration = revMin * 60 + revSec;
          const bleachDuration = bleachMin * 60 + bleachSec;
          
          const revIndex = currentSteps.findIndex(s => s.name.includes('DEVELOPER') && !s.name.includes('WASH'));
          const bleachIndex = currentSteps.findIndex(s => s.name === 'BLEACH');
          
          if (revIndex >= 0) currentSteps[revIndex].duration = revDuration;
          if (bleachIndex >= 0) currentSteps[bleachIndex].duration = bleachDuration;
        } catch (e) {
          createDefaultC41Steps();
        }
      } else {
        createDefaultC41Steps();
      }
      
      displaySteps();
    }

    function validateNB() {
      currentProcess = 'nb';
      
      const saved = localStorage.getItem('nb_steps');
      
      if (saved) {
        try {
          currentSteps = JSON.parse(saved);
          
          const revMin = parseInt(document.getElementById('nbRevMin').value) || 0;
          const revSec = parseInt(document.getElementById('nbRevSec').value) || 0;
          const fixMin = parseInt(document.getElementById('nbFixMin').value) || 0;
          const fixSec = parseInt(document.getElementById('nbFixSec').value) || 0;
          
          const revDuration = revMin * 60 + revSec;
          const fixDuration = fixMin * 60 + fixSec;
          
          const revIndex = currentSteps.findIndex(s => s.name.includes('DEVELOPER') && !s.name.includes('WASH'));
          const fixIndex = currentSteps.findIndex(s => s.name === 'FIXER');
          
          if (revIndex >= 0) currentSteps[revIndex].duration = revDuration;
          if (fixIndex >= 0) currentSteps[fixIndex].duration = fixDuration;
        } catch (e) {
          createDefaultNBSteps();
        }
      } else {
        createDefaultNBSteps();
      }
      
      displaySteps();
    }
    
    function createDefaultNBSteps() {
      const revMin = parseInt(document.getElementById('nbRevMin').value) || 0;
      const revSec = parseInt(document.getElementById('nbRevSec').value) || 0;
      const fixMin = parseInt(document.getElementById('nbFixMin').value) || 0;
      const fixSec = parseInt(document.getElementById('nbFixSec').value) || 0;
      
      const revDuration = revMin * 60 + revSec;
      const fixDuration = fixMin * 60 + fixSec;
      
      currentSteps = [
        { name: 'PRE-WASH', duration: 60 },
        { name: 'DEVELOPER', duration: revDuration },
        { name: 'WASH DEVELOPER', duration: 60 },
        { name: 'FIXER', duration: fixDuration },
        { name: 'WASH FIXER', duration: 60 }
      ];
    }
    
    function createDefaultC41Steps() {
      const revMin = parseInt(document.getElementById('revMin').value) || 0;
      const revSec = parseInt(document.getElementById('revSec').value) || 0;
      const bleachMin = parseInt(document.getElementById('bleachMin').value) || 0;
      const bleachSec = parseInt(document.getElementById('bleachSec').value) || 0;
      
      const revDuration = revMin * 60 + revSec;
      const bleachDuration = bleachMin * 60 + bleachSec;
      
      currentSteps = [
        { name: 'PRE-WASH #1', duration: 60 },
        { name: 'PRE-WASH #2', duration: 60 },
        { name: 'DEVELOPER', duration: revDuration },
        { name: 'WASH DEVELOPER', duration: 60 },
        { name: 'BLEACH', duration: bleachDuration },
        { name: 'WASH BLEACH #1', duration: 60 },
        { name: 'WASH BLEACH #2', duration: 60 },
        { name: 'STABILIZER', duration: 60 },
        { name: 'WASH STABILIZER', duration: 60 }
      ];
    }

    function displaySteps() {
      document.getElementById('configC41Screen').classList.add('hidden');
      document.getElementById('configNBScreen').classList.add('hidden');
      document.getElementById('stepsScreen').classList.remove('hidden');
      
      const totalSeconds = currentSteps.reduce((sum, step) => sum + step.duration, 0);
      const totalMins = Math.floor(totalSeconds / 60);
      const totalSecs = totalSeconds % 60;
      document.getElementById('totalTime').textContent = `${totalMins}:${totalSecs.toString().padStart(2, '0')}`;
      
      const progressPercentage = currentSteps.length > 0 
        ? Math.round((completedSteps.length / currentSteps.length) * 100)
        : 0;
      document.getElementById('progressPercentage').textContent = `${progressPercentage}%`;
      
      const stepsMatrix = document.getElementById('stepsMatrix');
      stepsMatrix.innerHTML = '';
      
      currentSteps.forEach((step, index) => {
        const dot = document.createElement('div');
        dot.className = 'step-dot';
        dot.setAttribute('data-name', step.name);
        
        if (completedSteps.includes(index)) {
          dot.classList.add('completed');
        }
        
        stepsMatrix.appendChild(dot);
      });
      
      const stepsDetails = document.getElementById('stepsDetails');
      stepsDetails.innerHTML = '';
      
      currentSteps.forEach((step, index) => {
        const detailItem = document.createElement('div');
        detailItem.className = 'step-detail-item';
        
        if (completedSteps.includes(index)) {
          detailItem.classList.add('completed');
        }
        
        const minutes = Math.floor(step.duration / 60);
        const seconds = step.duration % 60;
        
        detailItem.innerHTML = `
          <div class="step-detail-name">${step.name}</div>
          <div class="step-detail-time">_ ${minutes}:${seconds.toString().padStart(2, '0')}</div>
        `;
        
        stepsDetails.appendChild(detailItem);
      });
    }

    function startProcess() {
      currentStepIndex = 0;
      completedSteps = [];
      
      document.getElementById('stepsScreen').classList.add('hidden');
      document.getElementById('timerScreen').classList.remove('hidden');
      
      initTimer();
    }

    function initTimer() {
      const step = currentSteps[currentStepIndex];
      remainingSeconds = step.duration;
      
      document.getElementById('currentStepName').textContent = step.name;
      
      updateCountdownDisplay();
      
      updateProgressDots();
      
      isRunning = false;
      const btn = document.getElementById('playPauseBtn');
      btn.textContent = 'START';
      btn.classList.remove('pause', 'resume');
      btn.classList.add('primary');
    }

    function toggleTimer() {
      if (isRunning) {
        pauseTimer();
      } else {
        startTimer();
      }
    }

    function startTimer() {
      isRunning = true;
      
      requestWakeLock();
      
      const btn = document.getElementById('playPauseBtn');
      btn.textContent = 'PAUSE';
      btn.classList.remove('resume', 'primary');
      btn.classList.add('pause');
      
      if (remainingSeconds <= 0) {
        isRunning = false;
        releaseWakeLock();
        playStepCompleteSound();
        
        btn.textContent = 'DONE';
        btn.classList.remove('pause', 'resume', 'primary');
        btn.classList.add('disabled');
        btn.disabled = true;
        return;
      }
      
      timerInterval = setInterval(() => {
        remainingSeconds--;
        updateCountdownDisplay();
        updateProgressDots();
        
        if (remainingSeconds <= 0) {
          clearInterval(timerInterval);
          isRunning = false;
          releaseWakeLock();
          playStepCompleteSound();
          
          const btn = document.getElementById('playPauseBtn');
          btn.textContent = 'DONE';
          btn.classList.remove('pause', 'resume', 'primary');
          btn.classList.add('disabled');
          btn.disabled = true;
        }
      }, 1000);
    }

    function playStepCompleteSound() {
      const sound = document.getElementById('stepCompleteSound');
      if (sound) {
        sound.currentTime = 0;
        sound.play().catch(err => {
          console.log('Lecture audio bloquée:', err);
        });
      }
    }

    function pauseTimer() {
      isRunning = false;
      clearInterval(timerInterval);
      
      releaseWakeLock();
      
      const btn = document.getElementById('playPauseBtn');
      btn.textContent = 'RESUME';
      btn.classList.remove('primary');
      btn.classList.add('resume');
    }

    function nextStep() {
      completedSteps.push(currentStepIndex);
      
      if (currentStepIndex < currentSteps.length - 1) {
        currentStepIndex++;
        initTimer();
        
        const btn = document.getElementById('playPauseBtn');
        btn.disabled = false;
        btn.classList.remove('disabled');
      } else {
        showCompletionScreen();
      }
    }

    function skipStep() {
      clearInterval(timerInterval);
      releaseWakeLock();
      completedSteps.push(currentStepIndex);
      
      if (currentStepIndex < currentSteps.length - 1) {
        currentStepIndex++;
        initTimer();
        
        const btn = document.getElementById('playPauseBtn');
        btn.disabled = false;
        btn.classList.remove('disabled');
      } else {
        showCompletionScreen();
      }
    }

    function showCompletionScreen() {
      clearInterval(timerInterval);
      isRunning = false;
      
      releaseWakeLock();
      
      document.getElementById('timerScreen').classList.add('hidden');
      document.getElementById('stepsScreen').classList.remove('hidden');
      displaySteps();
      
      const startBtn = document.querySelector('.start-btn');
      startBtn.textContent = 'new development';
      startBtn.style.padding = '20px 40px';
      startBtn.style.width = 'auto';
      
      startBtn.onclick = () => {
        currentStepIndex = 0;
        completedSteps = [];
        
        startBtn.textContent = 'start';
        startBtn.style.padding = '20px 60px';
        startBtn.style.width = 'auto';
        startBtn.onclick = startProcess;
        
        document.getElementById('stepsScreen').classList.add('hidden');
        document.getElementById('welcomeScreen').classList.remove('hidden');
      };
    }

    function resetTimer() {
      const step = currentSteps[currentStepIndex];
      const minutes = Math.floor(step.duration / 60);
      const seconds = step.duration % 60;
      const timeDisplay = `${minutes}:${seconds.toString().padStart(2, '0')}`;
      
      document.querySelector('.modal-message').textContent = `Reset the current step timer to ${timeDisplay} ?`;
      document.getElementById('confirmModal').classList.remove('hidden');
    }

    function closeModal() {
      document.getElementById('confirmModal').classList.add('hidden');
    }

    function confirmReset() {
      closeModal();
      clearInterval(timerInterval);
      isRunning = false;
      
      releaseWakeLock();
      
      const step = currentSteps[currentStepIndex];
      remainingSeconds = step.duration;
      
      updateCountdownDisplay();
      
      const btn = document.getElementById('playPauseBtn');
      btn.textContent = 'START';
      btn.classList.remove('pause', 'resume', 'disabled');
      btn.classList.add('primary');
      btn.disabled = false;
    }

    function backToSteps() {
      clearInterval(timerInterval);
      isRunning = false;
      
      releaseWakeLock();
      
      document.getElementById('timerScreen').classList.add('hidden');
      document.getElementById('stepsScreen').classList.remove('hidden');
      displaySteps();
    }

    function updateCountdownDisplay() {
      const minutes = Math.floor(remainingSeconds / 60);
      const seconds = remainingSeconds % 60;
      
      const minutesEl = document.getElementById('countdownMinutes');
      const secondsEl = document.getElementById('countdownSeconds');
      const separatorEl = document.querySelector('.countdown-separator');
      
      minutesEl.textContent = minutes;
      secondsEl.textContent = seconds.toString().padStart(2, '0');
      
      if (remainingSeconds <= 10 && remainingSeconds > 0) {
        minutesEl.classList.add('warning');
        secondsEl.classList.add('warning');
        if (separatorEl) separatorEl.classList.add('warning');
      } else {
        minutesEl.classList.remove('warning');
        secondsEl.classList.remove('warning');
        if (separatorEl) separatorEl.classList.remove('warning');
      }
    }

    function updateProgressDots() {
      const dotsContainer = document.getElementById('progressDots');
      dotsContainer.innerHTML = '';
      
      currentSteps.forEach((step, index) => {
        const dot = document.createElement('div');
        dot.className = 'progress-dot';
        
        if (completedSteps.includes(index)) {
          dot.classList.add('completed');
        } else if (index === currentStepIndex) {
          dot.classList.add('active');
        }
        
        dotsContainer.appendChild(dot);
      });
    }

    function openSettings() {
      document.getElementById('stepsScreen').classList.add('hidden');
      document.getElementById('settingsScreen').classList.remove('hidden');
      displaySettings();
    }

    function closeSettings() {
      document.getElementById('settingsScreen').classList.add('hidden');
      document.getElementById('stepsScreen').classList.remove('hidden');
      displaySteps();
    }

    function displaySettings() {
      const settingsList = document.getElementById('settingsList');
      settingsList.innerHTML = '';
      
      currentSteps.forEach((step, index) => {
        const settingItem = document.createElement('div');
        settingItem.className = 'setting-item';
        
        const orderNum = document.createElement('div');
        orderNum.className = 'order-number';
        orderNum.textContent = (index + 1);
        
        const nameInput = document.createElement('input');
        nameInput.type = 'text';
        nameInput.value = step.name;
        nameInput.oninput = (e) => {
          currentSteps[index].name = e.target.value.toUpperCase();
        };
        
        const timeGroup = document.createElement('div');
        timeGroup.className = 'time-group';
        
        const timeDisplay = document.createElement('div');
        timeDisplay.className = 'time-display';
        const minutes = Math.floor(step.duration / 60);
        const seconds = step.duration % 60;
        timeDisplay.textContent = `_ ${minutes}:${seconds.toString().padStart(2, '0')}`;
        
        const timeEditContainer = document.createElement('div');
        timeEditContainer.className = 'time-edit-container hidden';
        
        const minInput = document.createElement('input');
        minInput.type = 'number';
        minInput.min = '0';
        minInput.value = Math.floor(step.duration / 60);
        minInput.inputMode = 'numeric';
        minInput.pattern = '[0-9]*';
        minInput.className = 'time-edit-input';
        minInput.oninput = (e) => {
          const mins = parseInt(e.target.value) || 0;
          const secs = currentSteps[index].duration % 60;
          currentSteps[index].duration = mins * 60 + secs;
          updateTimeDisplay();
        };
        
        const separator = document.createElement('span');
        separator.textContent = ':';
        separator.className = 'time-edit-separator';
        
        const secInput = document.createElement('input');
        secInput.type = 'number';
        secInput.min = '0';
        secInput.max = '59';
        secInput.value = step.duration % 60;
        secInput.inputMode = 'numeric';
        secInput.pattern = '[0-9]*';
        secInput.className = 'time-edit-input';
        secInput.oninput = (e) => {
          const mins = Math.floor(currentSteps[index].duration / 60);
          const secs = parseInt(e.target.value) || 0;
          currentSteps[index].duration = mins * 60 + secs;
          updateTimeDisplay();
        };
        
        function updateTimeDisplay() {
          const mins = Math.floor(currentSteps[index].duration / 60);
          const secs = currentSteps[index].duration % 60;
          timeDisplay.textContent = `_ ${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        timeDisplay.onclick = () => {
          timeDisplay.classList.add('hidden');
          timeEditContainer.classList.remove('hidden');
          minInput.focus();
        };
        
        const closeEdit = () => {
          timeDisplay.classList.remove('hidden');
          timeEditContainer.classList.add('hidden');
        };
        
        minInput.onblur = closeEdit;
        secInput.onblur = closeEdit;
        
        timeEditContainer.appendChild(minInput);
        timeEditContainer.appendChild(separator);
        timeEditContainer.appendChild(secInput);
        
        timeGroup.appendChild(timeDisplay);
        timeGroup.appendChild(timeEditContainer);
        
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'icon-btn';
        deleteBtn.innerHTML = '×';
        deleteBtn.style.color = '#FF6B35';
        deleteBtn.style.fontSize = '26px';
        deleteBtn.onclick = () => deleteStep(index);
        
        const upBtn = document.createElement('button');
        upBtn.className = 'arrow-btn';
        upBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>';
        upBtn.onclick = () => moveStep(index, -1);
        if (index === 0) upBtn.disabled = true;
        
        const downBtn = document.createElement('button');
        downBtn.className = 'arrow-btn';
        downBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/></svg>';
        downBtn.onclick = () => moveStep(index, 1);
        if (index === currentSteps.length - 1) downBtn.disabled = true;
        
        const controlsWrapper = document.createElement('div');
        controlsWrapper.className = 'controls-wrapper';
        controlsWrapper.appendChild(deleteBtn);
        controlsWrapper.appendChild(upBtn);
        controlsWrapper.appendChild(downBtn);
        
        settingItem.appendChild(orderNum);
        settingItem.appendChild(nameInput);
        settingItem.appendChild(timeGroup);
        settingItem.appendChild(controlsWrapper);
        
        settingsList.appendChild(settingItem);
      });
    }

    function moveStep(index, direction) {
      const newIndex = index + direction;
      
      if (newIndex < 0 || newIndex >= currentSteps.length) return;
      
      const temp = currentSteps[index];
      currentSteps[index] = currentSteps[newIndex];
      currentSteps[newIndex] = temp;
      
      displaySettings();
    }

    function deleteStep(index) {
      currentSteps.splice(index, 1);
      displaySettings();
    }

    function addNewStep() {
      currentSteps.push({
        name: 'NEW STEP',
        duration: 60
      });
      displaySettings();
    }

    function saveSettings() {
      const storageKey = currentProcess === 'c41' ? 'c41_steps' : 'nb_steps';
      localStorage.setItem(storageKey, JSON.stringify(currentSteps));
      closeSettings();
    }

    window.addEventListener('DOMContentLoaded', () => {
      localStorage.removeItem('c41_steps');
      localStorage.removeItem('nb_steps');
      
      const saved = localStorage.getItem('c41_steps');
      if (saved) {
        try {
          currentSteps = JSON.parse(saved);
        } catch (e) {
          console.error('Erreur de chargement:', e);
        }
      }
    });

    document.addEventListener('focus', (e) => {
      if (e.target.type === 'number') {
        e.target.select();
      }
    }, true);
  </script>
</body>
</html>
